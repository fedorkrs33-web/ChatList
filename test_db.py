# test_db.py
from db import db

def main():
    print("üîπ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...\n")

    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞: init_db() ‚Äî —Å–æ–∑–¥–∞—Å—Ç –ë–î –∏ —Ç–∞–±–ª–∏—Ü—ã
    print("1. ‚úÖ init_db() ‚Äî –∑–∞–ø—É—Å–∫...")
    # –ü—Ä–æ—Å—Ç–æ –∏–º–ø–æ—Ä—Ç db —É–∂–µ –≤—ã–∑—ã–≤–∞–µ—Ç init_db()
    print("   ‚Üí –ë–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")

    # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞: get_active_models()
    print("\n2. üîç get_active_models() ‚Äî –ø–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏...")
    models = db.get_active_models()
    if models:
        print(f"   ‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(models)} –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π:")
        for m in models:
            print(f"      - {m['name']} (ID={m['id']})")
    else:
        print("   ‚ùå –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ db.py –∏ INITIAL_MODELS")

    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞: save_prompt() –∏ get_all_prompts()
    print("\n3. üîΩ save_prompt() ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º—Ç...")
    prompt_id = db.save_prompt("–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏", "test,debug")
    print(f"   ‚úÖ –ü—Ä–æ–º—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω —Å ID = {prompt_id}")

    print("   üîé get_all_prompts() ‚Äî —á–∏—Ç–∞–µ–º –≤—Å–µ –ø—Ä–æ–º—Ç—ã...")
    prompts = db.get_all_prompts()
    if prompts:
        print(f"   ‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(prompts)} –ø—Ä–æ–º—Ç–æ–≤:")
        for p in prompts:
            print(f"      - [{p['id']}] {p['prompt']} ({p['created_at']})")
    else:
        print("   ‚ùå –ü—Ä–æ–º—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã ‚Äî –æ—à–∏–±–∫–∞")

    # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞: save_result()
    print("\n4. üíæ save_result() ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç...")
    if models:
        db.save_result(prompt_id=prompt_id, model_id=models[0]['id'], response="–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏.")
        print("   ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω")
    else:
        print("   ‚ùå –ù–µ–ª—å–∑—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –Ω–µ—Ç –º–æ–¥–µ–ª–µ–π")

    print("\n‚úÖ –¢–µ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à—ë–Ω.")

if __name__ == "__main__":
    main()
